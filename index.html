<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Circuito CHIP5 Oficial</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#0f0f0f;color:#fff;padding:20px}
h1{text-align:center;color:#FFD700}
h2{margin-top:40px;color:#FFD700}
table{width:100%;border-collapse:collapse;margin-top:15px;background:#1c1c1c}
th,td{border:1px solid #333;padding:8px;text-align:center}
th{background:#FFD700;color:#000}
.top1{background:#6b5e00}
.top2{background:#444}
.top3{background:#5a3d00}
input{margin:10px 0}
</style>
</head>
<body>

<h1>üèÜ Circuito CHIP5 2026</h1>

<h3>Importar Resultados (CSV)</h3>
<input type="file" id="fileInput">

<div id="rankings"></div>

<canvas id="grafico" style="margin-top:40px;"></canvas>

<script>

let atletas=[];

function pontuacao(pos){
if(pos==1)return 100;
if(pos==2)return 80;
if(pos==3)return 70;
if(pos==4)return 60;
if(pos==5)return 50;
if(pos==6)return 45;
if(pos==7)return 40;
if(pos==8)return 35;
if(pos==9)return 30;
if(pos==10)return 25;
return 10;
}

document.getElementById("fileInput").addEventListener("change",function(e){
let reader=new FileReader();
reader.onload=function(){
let linhas=reader.result.split("\n");
linhas.shift();

linhas.forEach(l=>{
let c=l.split(",");
if(c.length>4){
let nome=c[0];
let sexo=c[1];
let dist=c[2];
let cat=c[3];
let etapa=parseInt(c[4])-1;
let pos=parseInt(c[5]);

let atleta=atletas.find(a=>a.nome===nome);
if(!atleta){
atleta={nome,sexo,dist,cat,pontos:[0,0,0,0,0,0,0,0]};
atletas.push(atleta);
}
atleta.pontos[etapa]=pontuacao(pos);
}
});

atualizar();
}
reader.readAsText(e.target.files[0]);
});

function atualizar(){

let container=document.getElementById("rankings");
container.innerHTML="";

let grupos=[
{titulo:"5K Masculino",f:(a)=>a.dist=="5K"&&a.sexo=="M"},
{titulo:"5K Feminino",f:(a)=>a.dist=="5K"&&a.sexo=="F"},
{titulo:"10K Masculino",f:(a)=>a.dist=="10K"&&a.sexo=="M"},
{titulo:"10K Feminino",f:(a)=>a.dist=="10K"&&a.sexo=="F"},
];

grupos.forEach(g=>{

let lista=atletas.filter(g.f);

lista.forEach(a=>{
a.total=a.pontos.reduce((s,p)=>s+p,0);
let menor=Math.min(...a.pontos);
a.totalDesc=a.total-menor;
});

lista.sort((a,b)=>b.totalDesc-a.totalDesc);

if(lista.length>0){

container.innerHTML+=`<h2>${g.titulo}</h2>`;

let tabela="<table><tr><th>Pos</th><th>Nome</th><th>Categoria</th><th>Total c/ Descarte</th></tr>";

lista.forEach((a,i)=>{
let classe="";
if(i==0)classe="top1";
if(i==1)classe="top2";
if(i==2)classe="top3";

tabela+=`<tr class="${classe}">
<td>${i+1}</td>
<td>${a.nome}</td>
<td>${a.cat}</td>
<td>${a.totalDesc}</td>
</tr>`;
});

tabela+="</table>";
container.innerHTML+=tabela;
}
});

gerarGrafico();
}

function gerarGrafico(){
let ctx=document.getElementById("grafico");
if(atletas.length==0)return;

let a=atletas[0];

new Chart(ctx,{
type:"line",
data:{
labels:["E1","E2","E3","E4","E5","E6","E7","E8"],
datasets:[{
label:a.nome,
data:a.pontos
}]
}
});
}

</script>
</body>
</html>
